#!/usr/bin/env php
<?php

use OxidProfessionalServices\OxidConsole\Core\Application;

print "Oxid Professional Services consle  is called by $argv[0]\n";
$binFolder = dirname($argv[0]);
$autoloadFile = $binFolder.'/../autoload.php';

require_once $autoloadFile;
$projectRoot = realpath(dirname(dirname($binFolder)));

try {
    $application = new Application($projectRoot);
    $application->run();
} catch (Throwable $ex) {
    print "Oxid Professional Services Console is sorry about: \n";
    $trace = $e->getTrace();
    $cause = $trace[0];

    $result = 'Exception: "';
    $result .= $e->getMessage();
    $result .= '" @ ';
    $result .= $cause['file'].':'.$cause['line']."\n";
    if($cause['class'] != '') {
      $result .= $cause['class'];
      $result .= '->';
    }
    $result .= $cause['function'];
    $result .= "();\n";
    
    //console should print errors always
    print $ex->getTraceAsString();
    //shop exception handler may take care about error code and logging
    throw $ex;
}

print "Oxid Professional Services Console is done\n";
